# -*- coding: utf-8 -*-
import json

import requests

request_to_create = '{"WorkflowId":"db648adb-aa34-4b08-a4b0-e4a11a6b9e44","Name":"новая заявка","InitialTransitionId":"a36157a6-42ad-46bd-a75b-fe3e3e099f4b","ProcessContext":{"a":"1","b":"1","patient":{"idMPI":"17031996","identityDocument":{"system":"1.2.643.2.69.1.1.1.6.14","code":"1234:123123"},"birthDate":"2002-11-14","gender":"2","fullName":"Вакуленко Б. В.","registeredInTheRegion":true},"requesterPractitioner":{"identityDocument":{"system":"223","code":"001"},"fullName":"Петров Олег Егорович","position":"34","specialty":"26","department":"b19a2a66-c72c-f405-2c17-bfa785d29ffa","telecom":{"phone":"89128329813","email":"89128329813@mail.com"}},"serviceRequest":{"urgency":"3","primaryAppeal":"","anamnesis":"Болел","REGIS":[{"id":"1","system":"1.2.643.2.69.1.2.110","code":"69161b26-7aca-4562-8878-42958e2733ce","isDeleted":false}],"performerOrganization":"1","requesterOrganization":"3","category":"1","reasonCode":"7"},"requesterCondition":{"codeMKB":"T66","anamnesis":"Жалобы"},"profile":{"id":"56cda130-6bf9-4d78-bf66-b0983551fcd6"}},"roleContext":{"bf2e0147-ec85-489c-bd88-52331b0dc013":{"SNILS":"1","idLpu":"1"},"2a3c7729-1d9f-4284-ab7d-442b08293905":{"idLpu":"1"}}}'.encode('utf-8')
auth = 'N3 1a55e61b-dd7a-4acf-a94a-37d21d761af5'
response = requests.post('http://r78-dev.zdrav.netrika.ru/tm-core/api/Commands/StartNewProcess', data=request_to_create, headers={"Authorization": auth, "Content-type": "application/json"})
answer = response.json()
id = 'processId'
request_id = answer[id]
# request_to_change = '{"processId": ,"transitionId":"71118d78-7af2-434a-a4f2-3263f5003cfe","processContext":{"a":"1","b":"1","patient":{"idMPI":"8ff30a0b-85c3-462c-aae1-3ec719b3c1a3","identityDocument":{"system":"1.2.643.2.69.1.1.1.6.14","code":"1234:123123"},"birthDate":"2002-11-14","gender":"1","fullName":"Вакуленко Б. В.","registeredInTheRegion":true},"requesterPractitioner":{"identityDocument":{"system":"223","code":"001"},"fullName":"Петров Олег Егорович","position":"34","specialty":"26","department":"b19a2a66-c72c-f405-2c17-bfa785d29ffa","telecom":{"phone":"89128329813","email":"89128329813@mail.com"}},"serviceRequest":{"urgency":"3","primaryAppeal":"","anamnesis":"Болел","REGIS":[{"id":"1","system":"1.2.643.2.69.1.2.110","code":"69161b26-7aca-4562-8878-42958e2733ce","isDeleted":false}],"performerOrganization":"2","category":"108","reasonCode":"7"},"requesterCondition":{"codeMKB":"T66","anamnesis":"Жалобы"},"attachedfiles":[{"id":"1","fileURL":"2","isDeleted":false},{"id":"2","fileURL":"22","signatureURL":"123123","isDeleted":false}]},"roleContext":{"bf2e0147-ec85-489c-bd88-52331b0dc013":{"SNILS":"2","idLpu":"1"},"2a3c7729-1d9f-4284-ab7d-442b08293905":{"idLpu":"2"}}}'.encode('utf-8')
response1 = requests.post('http://r78-dev.zdrav.netrika.ru/tm-core/api/Commands/MoveToStage', data={"processId":request_id,"transitionId":"71118d78-7af2-434a-a4f2-3263f5003cfe","processContext":{"a":"1","b":"1","patient":{"idMPI":"8ff30a0b-85c3-462c-aae1-3ec719b3c1a3","identityDocument":{"system":"1.2.643.2.69.1.1.1.6.14","code":"1234:123123"},"birthDate":"2002-11-14","gender":"1","fullName":"Вакуленко Б. В.","registeredInTheRegion":'true'},"requesterPractitioner":{"identityDocument":{"system":"223","code":"001"},"fullName":"Петров Олег Егорович","position":"34","specialty":"26","department":"b19a2a66-c72c-f405-2c17-bfa785d29ffa","telecom":{"phone":"89128329813","email":"89128329813@mail.com"}},"serviceRequest":{"urgency":"3","primaryAppeal":"","anamnesis":"Болел","REGIS":[{"id":"1","system":"1.2.643.2.69.1.2.110","code":"69161b26-7aca-4562-8878-42958e2733ce","isDeleted":'false'}],"performerOrganization":"2","category":"108","reasonCode":"7"},"requesterCondition":{"codeMKB":"T66","anamnesis":"Жалобы"},"attachedfiles":[{"id":"1","fileURL":"2","isDeleted":'false'},{"id":"2","fileURL":"22","signatureURL":"123123","isDeleted":'false'}]},"roleContext":{"bf2e0147-ec85-489c-bd88-52331b0dc013":{"SNILS":"2","idLpu":"1"},"2a3c7729-1d9f-4284-ab7d-442b08293905":{"idLpu":"2"}}}, headers={"Authorization": auth, "Content-type": "application/json"})
print(response1.json())